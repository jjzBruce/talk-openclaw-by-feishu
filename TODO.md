# 待办需求

## 多机器人支持（扩展需求）

### 当前实现限制

- 当前代码设计仅支持单一飞书机器人
- 使用单一的 `FEISHU_VERIFICATION_TOKEN` 环境变量验证所有请求
- 数据库表结构缺少机器人标识字段
- 无法区分来自不同飞书机器人的消息

### 多机器人支持需求

- **机器人标识**: 在数据库中增加 `app_id` 或 `bot_id` 字段以区分不同机器人
- **验证令牌管理**: 支持多个机器人的 `app_id` 与 `verification_token` 映射关系
- **消息路由**: 根据回调中的 `app_id` 将消息路由到对应的处理流程
- **消息区分**: 在API接口中增加机器人标识参数，使OpenClaw端能够区分不同来源的消息

### 实现建议

- 扩展数据库表结构，增加机器人标识字段
- 使用配置文件或数据库存储多个机器人的验证令牌映射
- 在消息处理和查询接口中增加机器人过滤功能

### 实施步骤

1. **数据库迁移**
   - 在 `incoming_messages` 表中添加 `app_id` 字段
   - 在 `outgoing_messages` 表中添加 `app_id` 字段
   - 创建相应的索引以提高查询性能

2. **配置管理**
   - 修改环境变量配置，支持多个飞书应用的验证令牌
   - 可以使用 JSON 格式存储多个应用的配置

3. **代码修改**
   - 修改飞书回调处理逻辑，提取 `app_id` 并存储
   - 修改消息查询接口，支持按 `app_id` 过滤
   - 修改消息标记接口，包含 `app_id` 参数

4. **测试验证**
   - 创建多个飞书应用进行测试
   - 验证消息能够正确路由到对应的应用
   - 验证回复能够正确发送到对应的应用

### 优先级

中（P2）

### 预计工作量

3-5 个工作日